src = $(wildcard *.cc)
obj = $(src:.cc=.o)
dep = $(obj:.o=.d)

CC = aarch64-linux-gnu-g++
CXXFLAGS = -g
LDFLAGS = -static -rdynamic -lpthread

android: CXXFLAGS += -D __ANDROID__ -Wno-format-zero-length

all: kukui_exploit

simulate: CXXFLAGS += -DSIMULATE
simulate: kukui_exploit

kukui_exploit: $(obj)
	$(CC) -o $@ $^ $(LDFLAGS)

android: $(obj)
	$(CC) -o kukui_exploit $^ $(LDFLAGS)

%.o: %.cc
	$(CC) $(CXXFLAGS) -c $< -o $@

-include $(dep)

%.d: %.cc
	@$(CC) $(CXXFLAGS) $< -MM -MT $(@:.d=.o) >$@

.PHONY: clean
clean:
	rm -f $(obj) $(dep) kukui_exploit

